<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix Definitivo - 20250618-01</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .log { background-color: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .textarea-container { margin: 10px 0; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 3px; }
        .char-count { margin-top: 5px; font-size: 14px; color: #666; }
        .status { padding: 10px; margin: 10px 0; border-radius: 3px; font-weight: bold; }
        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.warning { background-color: #fff3cd; color: #856404; }
        .status.pending { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üõ† Test Fix Definitivo - Versione 20250618-01</h1>
        <p><strong>Obiettivo:</strong> Verificare che tutti i fix siano stati applicati correttamente al sito deployato.</p>
        
        <!-- Test 1: Marker Versione -->
        <div class="test-section">
            <h2>Test 1: Marker Versione</h2>
            <div id="version-status" class="status pending">Controllo in corso...</div>
            <div id="version-details"></div>
            <p><strong>Verifica:</strong> Il marker "üõ† Mental Commons script.js versione FIX 20250618-01 attivo" deve apparire in console.</p>
        </div>

        <!-- Test 2: Fix isProduction -->
        <div class="test-section">
            <h2>Test 2: Fix isProduction</h2>
            <div id="production-status" class="status pending">Controllo in corso...</div>
            <div id="production-details"></div>
            <p><strong>Verifica:</strong> Nessun errore di SyntaxError deve apparire in console.</p>
        </div>

        <!-- Test 3: Contatore Caratteri -->
        <div class="test-section">
            <h2>Test 3: Contatore Caratteri UCMe</h2>
            <div id="char-counter-status" class="status pending">Controllo in corso...</div>
            <div id="char-counter-details"></div>
            
            <div class="textarea-container">
                <label for="ucme-text">Testa il contatore qui:</label>
                <textarea id="ucme-text" placeholder="Scrivi qui per testare il contatore caratteri..."></textarea>
                <div class="char-count">Caratteri: <span id="char-count">0</span></div>
            </div>
        </div>

        <!-- Test 4: Console Errors -->
        <div class="test-section">
            <h2>Test 4: Errori Console</h2>
            <div id="console-status" class="status pending">Controllo in corso...</div>
            <div id="console-details"></div>
            <p><strong>Verifica:</strong> Nessun errore JavaScript critico deve essere presente.</p>
        </div>

        <!-- Log di Test -->
        <div class="test-section">
            <h2>Log di Test</h2>
            <div id="test-log" class="log"></div>
        </div>
    </div>

    <script>
        // Utility per logging
        function addToLog(message, type = 'info') {
            const log = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            log.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        // Intercetta errori console
        const originalError = console.error;
        const consoleErrors = [];
        console.error = function(...args) {
            consoleErrors.push(args);
            originalError.apply(console, args);
        };

        // Esegui test dopo caricamento DOM
        document.addEventListener('DOMContentLoaded', function() {
            addToLog('üöÄ Inizio test fix definitivo');
            
            // Test 1: Marker Versione
            testVersionMarker();
            
            // Test 2: Fix isProduction  
            testIsProduction();
            
            // Test 3: Contatore Caratteri
            testCharCounter();
            
            // Test 4: Console Errors (con delay)
            setTimeout(testConsoleErrors, 2000);
        });

        function testVersionMarker() {
            addToLog('üîç Test 1: Marker Versione');
            
            // Controlla se il marker √® apparso nei log console
            const logs = [];
            const originalLog = console.log;
            let markerFound = false;
            
            // Timeout per dare tempo al marker di apparire
            setTimeout(() => {
                // Controlla se il marker √® visibile nella console
                // Nota: questo test potrebbe non funzionare completamente in tutte le situazioni
                // ma l'utente pu√≤ verificare manualmente nella console
                
                const status = document.getElementById('version-status');
                const details = document.getElementById('version-details');
                
                status.className = 'status warning';
                status.textContent = '‚ö†Ô∏è Verifica manuale richiesta';
                details.innerHTML = `
                    <p><strong>Verifica manuale:</strong></p>
                    <p>1. Apri la Console del browser (F12)</p>
                    <p>2. Cerca il messaggio: <code>"üõ† Mental Commons script.js versione FIX 20250618-01 attivo"</code></p>
                    <p>3. Se il messaggio √® presente, il marker funziona correttamente</p>
                `;
                
                addToLog('‚ö†Ô∏è Test marker versione: verifica manuale richiesta');
            }, 500);
        }

        function testIsProduction() {
            addToLog('üîç Test 2: Fix isProduction');
            
            try {
                // Verifica che window.isProduction sia definito
                if (typeof window.isProduction !== 'undefined') {
                    const result = window.isProduction;
                    addToLog(`‚úÖ window.isProduction definito: ${result}`);
                    
                    const status = document.getElementById('production-status');
                    const details = document.getElementById('production-details');
                    
                    status.className = 'status success';
                    status.textContent = '‚úÖ Fix isProduction funzionante';
                    details.innerHTML = `
                        <p><strong>Risultato:</strong> window.isProduction = ${result}</p>
                        <p><strong>Tipo:</strong> ${typeof window.isProduction}</p>
                    `;
                } else {
                    throw new Error('window.isProduction non definito');
                }
            } catch (error) {
                addToLog(`‚ùå Errore test isProduction: ${error.message}`, 'error');
                
                const status = document.getElementById('production-status');
                const details = document.getElementById('production-details');
                
                status.className = 'status error';
                status.textContent = '‚ùå Fix isProduction NON funziona';
                details.innerHTML = `<strong>Errore:</strong> ${error.message}`;
            }
        }

        function testCharCounter() {
            addToLog('üîç Test 3: Contatore Caratteri');
            
            const textarea = document.getElementById('ucme-text');
            const counter = document.getElementById('char-count');
            
            if (textarea && counter) {
                // Test iniziale
                const initialLength = textarea.value.length;
                const initialCount = parseInt(counter.textContent);
                
                if (initialCount === initialLength) {
                    addToLog(`‚úÖ Contatore iniziale corretto: ${initialCount}`);
                    
                    // Test input simulato
                    textarea.value = 'Test contatore';
                    textarea.dispatchEvent(new Event('input'));
                    
                    setTimeout(() => {
                        const newCount = parseInt(counter.textContent);
                        const expectedCount = textarea.value.length;
                        
                        if (newCount === expectedCount) {
                            addToLog(`‚úÖ Contatore aggiornato correttamente: ${newCount}`);
                            
                            const status = document.getElementById('char-counter-status');
                            const details = document.getElementById('char-counter-details');
                            
                            status.className = 'status success';
                            status.textContent = '‚úÖ Contatore caratteri funzionante';
                            details.innerHTML = `
                                <p><strong>Test iniziale:</strong> ${initialLength} caratteri</p>
                                <p><strong>Test input:</strong> ${expectedCount} caratteri</p>
                                <p><strong>Aggiornamento:</strong> Automatico</p>
                            `;
                        } else {
                            throw new Error(`Contatore non aggiornato: atteso ${expectedCount}, ottenuto ${newCount}`);
                        }
                    }, 100);
                } else {
                    throw new Error(`Contatore iniziale errato: atteso ${initialLength}, ottenuto ${initialCount}`);
                }
            } else {
                throw new Error('Elementi contatore non trovati');
            }
        }

        function testConsoleErrors(error) {
            if (error) {
                addToLog(`‚ùå Errore test contatore: ${error.message}`, 'error');
                
                const status = document.getElementById('char-counter-status');
                const details = document.getElementById('char-counter-details');
                
                status.className = 'status error';
                status.textContent = '‚ùå Contatore caratteri NON funziona';
                details.innerHTML = `<strong>Errore:</strong> ${error.message}`;
            }
        }

        function testConsoleErrors() {
            addToLog('üîç Test 4: Errori Console');
            
            const status = document.getElementById('console-status');
            const details = document.getElementById('console-details');
            
            if (consoleErrors.length === 0) {
                addToLog('‚úÖ Nessun errore console rilevato');
                
                status.className = 'status success';
                status.textContent = '‚úÖ Console pulita';
                details.innerHTML = '<p><strong>Risultato:</strong> Nessun errore JavaScript critico rilevato</p>';
            } else {
                addToLog(`‚ö†Ô∏è Errori console rilevati: ${consoleErrors.length}`, 'warning');
                
                status.className = 'status warning';
                status.textContent = `‚ö†Ô∏è ${consoleErrors.length} errori rilevati`;
                details.innerHTML = `
                    <p><strong>Errori trovati:</strong></p>
                    <ul>
                        ${consoleErrors.map(error => `<li>${error.join(' ')}</li>`).join('')}
                    </ul>
                `;
            }
        }

        // Catch errori di test
        window.addEventListener('error', function(e) {
            addToLog(`‚ùå Errore JavaScript: ${e.message}`, 'error');
            consoleErrors.push([e.message, e.filename, e.lineno]);
        });
    </script>
</body>
</html> 